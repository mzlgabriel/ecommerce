import { useState } from "react";
import { Link } from "react-router-dom";

import { useAuth } from "../../Contextos/AuthContext";
import { useProduto } from "../../Contextos/ProdutoContext";
import { UserModal } from "../UserModal";

import { UserIcon } from "../Icones/User";
import { CloseIcon } from "../Icones/Close";
import { MenuIcon } from "../Icones/Menu";

import styles from './styles.module.scss';
import { CarrinhoModal } from "../CarrinhoModal";

export function Menu() {
  const [isOpen, setIsOpen] = useState(false);
  const [click, setClick] = useState(false);

  const { autenticado, carregando } = useAuth();
  const { colecoes } = useProduto();

  const handleClick = () => setClick(!click);

  const handleMouseEnter = () => {
    setIsOpen(true);
    clearTimeout(timeout);
  };

  let timeout

  const handleMouseLeave = () => {
    timeout = setTimeout(() => {
      setIsOpen(false);
    }, 350);
  };


  return (
    <header className={styles.menu}>
      <nav className={styles.menu__conteudo}>
        <ul className={styles.menu__navegacao}>
          <li>
            <svg width="150" height="40" viewBox="0 0 250 90" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M218.14 0.0283699C210.735 0.556125 204.795 2.93102 200.287 7.15306C197.98 9.31685 195.652 12.9478 194.504 16.1671C193.103 20.0936 192.429 24.0834 191.902 31.5775C191.734 33.9736 191.66 51.9489 191.797 55.5798C192.229 66.3883 193.524 72.5313 196.442 77.6505C200.94 85.5141 209.808 90 220.879 90C229.958 90 237.489 87.0129 242.493 81.4187C247.211 76.1412 249.128 69.692 249.866 56.5403C250.045 53.3316 250.045 36.8023 249.866 33.5302C249.413 25.1495 248.549 20.1358 246.832 15.7555C245.484 12.3356 243.62 9.41185 241.45 7.34305C237.31 3.38489 232.002 1.0311 225.408 0.218362C224.144 0.0600352 219.415 -0.0560709 218.14 0.0283699ZM224.944 4.1343C229.221 4.64095 233.539 6.19255 236.468 8.2719C237.984 9.35907 239.954 11.3751 240.923 12.8423C243.62 16.9376 244.978 21.6874 245.568 29.2027C246.285 38.1639 246.285 53.2472 245.579 61.1846C245.084 66.7049 244.209 70.6314 242.745 73.9457C241.018 77.8722 237.711 81.2393 233.518 83.3503C229.811 85.208 226.019 86.0207 220.931 86.0207C215.812 86.0313 212.02 85.2291 208.186 83.3503C201.561 80.0993 197.885 74.4101 196.589 65.4066C195.915 60.6991 195.599 54.1338 195.599 44.8242C195.599 28.1049 196.495 20.653 199.149 15.3227C202.53 8.52522 209.071 4.64095 218.245 3.97598C219.941 3.85987 223.217 3.93376 224.944 4.1343Z" fill="black"></path><path d="M218.646 12.9584C217.529 13.0956 216.002 13.4967 214.927 13.94C210.051 15.9243 207.428 20.7902 206.712 29.1499C206.385 33.0553 206.301 36.3273 206.301 45.2992C206.301 56.3926 206.48 60.4141 207.133 64.3089C207.586 66.9793 207.997 68.3198 208.955 70.2092C210.872 73.9774 213.695 76.12 217.74 76.88C219.13 77.1333 222.438 77.1333 223.881 76.8695C228.547 76.025 231.517 73.5129 233.023 69.1431C234.582 64.6467 235.414 56.2131 235.414 44.9297C235.414 33.9419 234.624 25.6456 233.129 21.0225C231.717 16.621 228.62 13.9505 223.975 13.1061C222.848 12.9056 219.773 12.8106 218.646 12.9584ZM222.195 16.8532C224.66 17.096 226.187 17.7293 227.514 19.0592C228.926 20.4841 229.726 22.5002 230.348 26.1944C231.127 30.7859 231.433 36.1479 231.433 44.9297C231.433 53.8805 231.117 59.2213 230.306 63.8761C229.474 68.7104 228.252 70.948 225.777 72.1724C223.638 73.2279 220.247 73.4813 217.571 72.7952C214.496 72.0036 212.22 69.2803 211.294 65.2483C210.504 61.8284 210.261 57.9125 210.177 47.6741C210.051 33.2769 210.419 27.5455 211.736 23.3973C212.852 19.8825 214.538 18.067 217.487 17.2226C218.972 16.7899 220.363 16.6843 222.195 16.8532Z" fill="black"></path><path d="M154.046 0.250023C150.286 0.556121 147.769 1.05221 145.083 2.03383C139.679 3.98653 135.698 7.24805 133.001 11.9134C130.315 16.5365 128.767 22.4579 128.146 30.4693C127.651 36.6968 127.629 49.9962 128.082 57.2264C128.883 69.7448 131.316 77.2072 136.298 82.432C139.016 85.2924 142.46 87.2873 146.831 88.5645C150.075 89.5039 152.603 89.8417 156.522 89.8311C160.545 89.8311 163.063 89.4617 166.254 88.4062C169.804 87.2346 172.648 85.5246 175.26 82.9809C178.873 79.4555 181.148 75.1279 182.265 69.6287C182.823 66.9055 182.875 66.1877 182.928 61.0474L182.981 56.2237H173.543H164.106V59.4641C164.106 61.2585 164.053 63.2639 164 63.9289C163.579 68.7631 162.294 71.5391 159.955 72.6896C158.776 73.2807 157.849 73.4602 155.995 73.4602C154.078 73.4602 153.109 73.2702 151.834 72.6474C148.485 71.0008 147.158 67.0638 146.389 56.4348C146.189 53.7749 146.199 34.1424 146.389 31.3664C146.779 25.8145 147.421 22.4368 148.485 20.4208C149.233 18.9959 150.707 17.6976 152.245 17.1171C153.467 16.6526 154.341 16.5154 155.995 16.5154C157.817 16.5049 158.765 16.6843 159.871 17.2332C161.272 17.9193 162.188 19.1331 162.778 21.0752C163.326 22.8696 163.389 23.4818 163.442 27.7988L163.495 31.8414H172.974H182.454L182.401 27.7988C182.349 23.6612 182.265 22.6796 181.801 20.178C181.148 16.7371 179.947 13.4861 178.378 10.9951C174.312 4.51428 167.982 0.978325 159.165 0.292244C157.859 0.186693 155.068 0.165583 154.046 0.250023ZM159.892 4.30318C168.993 5.21092 175.113 10.2351 177.43 18.7109C178.062 21.033 178.536 24.5479 178.536 26.9544V27.8305H172.964H167.402L167.339 25.635C167.276 23.1757 167.034 21.4763 166.507 19.8086C165.527 16.7265 163.695 14.5522 161.177 13.4756C158.323 12.2617 154.046 12.2301 150.929 13.4122C147.895 14.5522 145.578 16.8637 144.377 19.9669C142.776 24.1257 142.291 29.8887 142.27 45.1408C142.26 53.7116 142.428 57.712 142.997 62.1345C143.798 68.4043 144.998 71.7608 147.284 74.1357C149.517 76.4578 152.688 77.5661 156.627 77.4078C162.009 77.1861 165.317 74.6846 166.928 69.6181C167.581 67.5493 167.887 65.47 167.992 62.3457L168.055 60.1819L173.564 60.1502L179.062 60.1291V62.0079C179.062 67.0216 178.178 71.2647 176.377 74.8534C174.007 79.5927 170.225 82.8964 165.243 84.6063C159.871 86.4429 152.73 86.4007 147 84.4902C142.081 82.8542 138.668 80.0677 136.214 75.6978C134.076 71.8769 132.864 66.8949 132.243 59.443C131.769 53.6271 131.569 45.1092 131.748 38.3539C132.022 28.4427 132.601 23.7668 134.192 18.9325C135.624 14.5944 137.71 11.2907 140.459 9.04242C145.072 5.26369 152.161 3.53266 159.892 4.30318Z" fill="black"></path><path d="M0 8.19801V12.6312H10.4804H20.9608V50.9989V89.3667H26.596H32.2312V50.9989V12.6312L42.4272 12.61L52.6127 12.5784L52.6443 8.16635L52.6654 3.76487H26.3327H0V8.19801Z" fill="black"></path><path d="M80.3675 3.81765C80.3675 3.84931 74.3742 23.0279 67.0431 46.4391C59.7121 69.8398 53.6872 89.0817 53.6556 89.1767C53.6029 89.3561 53.94 89.3667 59.7121 89.3667C65.4316 89.3667 65.8213 89.3561 65.874 89.1767C65.9056 89.0817 67.1379 84.7224 68.6231 79.4977C70.1083 74.2729 71.4144 69.6814 71.5302 69.2803L71.7409 68.5732H86.8453C101.139 68.5732 101.95 68.5837 102.002 68.7526C102.203 69.4598 107.648 89.2717 107.648 89.3139C107.648 89.3456 110.429 89.3667 113.821 89.3667H119.993L119.93 89.1239C119.898 88.9973 114.031 69.7342 106.89 46.323L93.9025 3.76487H87.1402C83.4115 3.76487 80.3675 3.78598 80.3675 3.81765ZM93.0177 37.8367L98.9689 58.3875L86.8137 58.4192C80.1147 58.4297 74.6269 58.4297 74.6164 58.4086C74.5743 58.3664 86.9401 17.2754 87.0033 17.2754C87.0349 17.2754 89.7419 26.5322 93.0177 37.8367Z" fill="black"></path></svg>
          </li>
          <li>
            <Link to="/" className='active'>Início</Link>
          </li>
          <li>
            <div className={styles.dropdown__link} onMouseEnter={handleMouseEnter} onMouseLeave={handleMouseLeave}>
              Coleção
            </div>
          </li>
        </ul>

        <div className={styles.menu__icones}>
          <a onClick={handleClick} className={styles.menu__mobile_icon}>
            {click ? <CloseIcon /> : <MenuIcon />}
          </a>
          {autenticado ? (
            <UserModal />
          ) : (
            <Link to="/login">
              <UserIcon />
            </Link>
          )}
          <CarrinhoModal />
        </div>
      </nav>

      {isOpen && (
        <div className={styles.dropdown} onMouseEnter={handleMouseEnter} onMouseLeave={handleMouseLeave}>
          <div className={styles.dropdown__content}>
            <div className={styles.dropdown__menu}>
              {colecoes.map(colecao => (
                <Link to={`/colecao/${colecao.Slug}`} key={colecao.Colecao_ID}>
                  {colecao.Nome}
                </Link>
              ))}
            </div>
          </div>
        </div>
      )}

      {click && (
        <div className={styles.menu__mobile}>
          <div className={styles.titulo}>
            <h2>Menu</h2>
            <p>Confira todas as páginas disponíveis.</p>
          </div>
          <ul>
            <li>
              <Link to="/">Início</Link>
            </li>
            <div className={styles.colecoes__mobile}>
              Coleções
            </div>
          </ul>
        </div>
      )}

    </header>
  )
}